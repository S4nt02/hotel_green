{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import{API_URL}from'../url';import{set}from'react-hook-form';// Criando o contexto\nimport{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();// Provedor do contexto\nexport const AuthProvider=_ref=>{let{children}=_ref;const[id,setId]=useState(null);const[nomeUser,setNomeUser]=useState(null);const[autorizacao,setAutorizacao]=useState(null);const[carregando,setCarregando]=useState(true);// Função para verificar se o usuário está logado\nconst verificarLogin=async()=>{try{const resposta=await fetch(`${API_URL}/auth/verify`,{method:'GET',credentials:'include'// Isso garante que o cookie de sessão seja enviado\n});const data=await resposta.json();if(data.autenticado){setId(data.id);setAutorizacao(data.autorizacao);setNomeUser(data.nome);}else{setId(null);setAutorizacao(null);setNomeUser(null);}}catch(erro){console.error('Erro ao verificar login:',erro);setId(null);setAutorizacao(null);setNomeUser(null);}finally{setCarregando(false);}console.log(id);console.log(autorizacao);};// Verificando o login na montagem do componente\nuseEffect(()=>{verificarLogin();},[]);// Função para fazer o login\nconst login=async(email,senha)=>{const resposta=await fetch(`${API_URL}/login`,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({email,senha})});const data=await resposta.json();if(data.logado){setId(data.usuario.id);setAutorizacao(data.usuario.autorizacao||null);}else{throw new Error(\"Falha no login\");}};// Função para fazer o logout\nconst logout=async()=>{console.log(\"chamando logout...\");try{const resposta=await fetch(`${API_URL}/logout`,{method:'POST',credentials:'include'// Envia os cookies de sessão\n});if(resposta.ok){console.log(\"Logout bem-sucedido\");setId(null);setAutorizacao(null);}else{console.error(\"Erro ao fazer logout:\",resposta.status);throw new Error('Falha ao realizar logout');}}catch(erro){console.error(\"Erro na requisição de logout:\",erro);}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{id,login,logout,carregando,autorizacao,nomeUser},children:children});};// Hook para consumir o contexto\nexport const useAuth=()=>{return useContext(AuthContext);};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","API_URL","set","jsx","_jsx","AuthContext","AuthProvider","_ref","children","id","setId","nomeUser","setNomeUser","autorizacao","setAutorizacao","carregando","setCarregando","verificarLogin","resposta","fetch","method","credentials","data","json","autenticado","nome","erro","console","error","log","login","email","senha","headers","body","JSON","stringify","logado","usuario","Error","logout","ok","status","Provider","value","useAuth"],"sources":["C:/Users/andre/hotel_green/frontend/src/context/authContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport { API_URL } from '../url';\r\nimport { set } from 'react-hook-form';\r\n\r\n// Criando o contexto\r\nconst AuthContext = createContext();\r\n\r\n// Provedor do contexto\r\nexport const AuthProvider = ({ children }) => {\r\n  const [id, setId] = useState(null);\r\n  const [nomeUser, setNomeUser] = useState(null)\r\n  const [autorizacao, setAutorizacao] = useState(null)\r\n  const [carregando, setCarregando] = useState(true);\r\n\r\n  // Função para verificar se o usuário está logado\r\n  const verificarLogin = async () => {\r\n    try {\r\n      const resposta = await fetch(`${API_URL}/auth/verify`, {\r\n        method: 'GET',\r\n        credentials: 'include', // Isso garante que o cookie de sessão seja enviado\r\n      });\r\n      const data = await resposta.json();\r\n      if (data.autenticado) {\r\n        setId(data.id);\r\n        setAutorizacao(data.autorizacao)\r\n        setNomeUser(data.nome)\r\n      } else {\r\n        setId(null);\r\n        setAutorizacao(null)\r\n        setNomeUser(null)\r\n      }\r\n    } catch (erro) {\r\n      console.error('Erro ao verificar login:', erro);\r\n      setId(null);\r\n      setAutorizacao(null)\r\n      setNomeUser(null)\r\n    } finally {\r\n      setCarregando(false);\r\n    }\r\n    console.log(id)\r\n    console.log(autorizacao)\r\n  };\r\n\r\n  // Verificando o login na montagem do componente\r\n  useEffect(() => {\r\n    verificarLogin();\r\n  }, []);\r\n\r\n  // Função para fazer o login\r\n  const login = async (email, senha) => {\r\n    const resposta = await fetch(`${API_URL}/login`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      credentials: 'include',\r\n      body: JSON.stringify({ email, senha }),\r\n    });\r\n  \r\n    const data = await resposta.json();\r\n  \r\n    if (data.logado) {\r\n      setId(data.usuario.id); \r\n      setAutorizacao(data.usuario.autorizacao || null); \r\n    } else {\r\n      throw new Error(\"Falha no login\");\r\n    }\r\n  };\r\n  \r\n  \r\n\r\n  // Função para fazer o logout\r\n  const logout = async () => {\r\n    console.log(\"chamando logout...\");\r\n    try {\r\n      const resposta = await fetch(`${API_URL}/logout`, {\r\n        method: 'POST',\r\n        credentials: 'include', // Envia os cookies de sessão\r\n      });\r\n  \r\n      if (resposta.ok) {\r\n        console.log(\"Logout bem-sucedido\");\r\n        setId(null);\r\n        setAutorizacao(null);\r\n      } else {\r\n        console.error(\"Erro ao fazer logout:\", resposta.status);\r\n        throw new Error('Falha ao realizar logout');\r\n      }\r\n    } catch (erro) {\r\n      console.error(\"Erro na requisição de logout:\", erro);\r\n    }\r\n  };\r\n  \r\n  \r\n  \r\n\r\n  return (\r\n    <AuthContext.Provider value={{ id, login, logout, carregando, autorizacao, nomeUser }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// Hook para consumir o contexto\r\nexport const useAuth = () => {\r\n  return useContext(AuthContext);\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}